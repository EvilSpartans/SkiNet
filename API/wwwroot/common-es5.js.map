{"version":3,"sources":["webpack:///src/app/shared/models/pagination.ts","webpack:///src/app/shared/models/shopParams.ts","webpack:///src/app/shop/shop.service.ts"],"names":["Pagination","data","ShopParams","brandId","typeId","sort","pageNumber","pageSize","ShopService","http","baseUrl","apiUrl","products","brands","types","pagination","shopParams","useCache","length","pagesReceived","Math","ceil","slice","params","append","toString","search","get","observe","pipe","response","body","id","product","find","p"],"mappings":"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","file":"common-es5.js","sourcesContent":["import {IProduct} from './product';\n\nexport interface IPagination {\n    pageIndex: number;\n    pageSize: number;\n    count: number;\n    data: IProduct[];\n}\n\nexport class Pagination implements IPagination {\n    pageIndex: number;\n    pageSize: number;\n    count: number;\n    data: IProduct[] = [];\n}\n","export class ShopParams {\n    brandId = 0;\n    typeId = 0;\n    sort = 'name';\n    pageNumber = 1;\n    pageSize = 6;\n    search: string;\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { IPagination, Pagination } from '../shared/models/pagination';\nimport { IBrand } from '../shared/models/brand';\nimport { IType } from '../shared/models/productType';\nimport { map, delay } from 'rxjs/operators';\nimport { ShopParams } from '../shared/models/shopParams';\nimport { IProduct } from '../shared/models/product';\nimport { of } from 'rxjs';\nimport { environment } from 'src/environments/environment';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ShopService {\n  baseUrl = environment.apiUrl;\n  products: IProduct[] = [];\n  brands: IBrand[] = [];\n  types: IType[] = [];\n  pagination = new Pagination();\n  shopParams = new ShopParams();\n\n  constructor(private http: HttpClient) { }\n\n  getProducts(useCache: boolean) {\n    if (useCache === false) {\n      this.products = [];\n    }\n\n    if (this.products.length > 0 && useCache === true) {\n      const pagesReceived = Math.ceil(this.products.length / this.shopParams.pageSize);\n\n      if (this.shopParams.pageNumber <= pagesReceived) {\n        this.pagination.data =\n          this.products.slice((this.shopParams.pageNumber - 1) * this.shopParams.pageSize,\n            this.shopParams.pageNumber * this.shopParams.pageSize);\n\n        return of(this.pagination);\n      }\n    }\n\n    let params = new HttpParams();\n\n    if (this.shopParams.brandId !== 0) {\n      params = params.append('brandId', this.shopParams.brandId.toString());\n    }\n\n    if (this.shopParams.typeId !== 0) {\n      params = params.append('typeId', this.shopParams.typeId.toString());\n    }\n\n    if (this.shopParams.search) {\n      params = params.append('search', this.shopParams.search);\n    }\n\n    params = params.append('sort', this.shopParams.sort);\n    params = params.append('pageIndex', this.shopParams.pageNumber.toString());\n    params = params.append('pageSize', this.shopParams.pageSize.toString());\n\n    return this.http.get<IPagination>(this.baseUrl + 'products', { observe: 'response', params })\n      .pipe(\n        map(response => {\n          this.products = [...this.products, ...response.body.data];\n          this.pagination = response.body;\n          return this.pagination;\n        })\n      );\n  }\n\n  getShopParams() {\n    return this.shopParams;\n  }\n\n  setShopParams(params: ShopParams) {\n    this.shopParams = params;\n  }\n\n  getProduct(id: number) {\n    const product = this.products.find(p => p.id === id);\n\n    if (product) {\n      return of(product);\n    }\n\n    return this.http.get<IProduct>(this.baseUrl + 'products/' + id);\n  }\n\n  getBrands() {\n    if (this.brands.length > 0) {\n      return of(this.brands);\n    }\n    return this.http.get<IBrand[]>(this.baseUrl + 'products/brands').pipe(\n      map(response => {\n        this.brands = response;\n        return response;\n      })\n    );\n  }\n\n  getTypes() {\n    if (this.types.length > 0) {\n      return of(this.types);\n    }\n    return this.http.get<IType[]>(this.baseUrl + 'products/types').pipe(\n      map(response => {\n        this.types = response;\n        return response;\n      })\n    );\n  }\n}\n"]}